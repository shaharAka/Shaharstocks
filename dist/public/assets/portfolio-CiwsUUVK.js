import{c as ae,u as Q,a as ie,b as ee,r as p,d as xe,e as G,q as $,j as e,C as f,f as S,g as k,h as v,A as Ze,i as es,B as F,k as ss,D as ne,l as le,m as ce,n as oe,T as te,o as je,p as Fe,s as ke,t as de,v as Y,L as ts,w as as,x as is,y as rs,S as ns,z as ls,E as cs,F as os,G as ge,H as ds,X as ms,I as xs,J as us,K as hs,M as ps,N as fs,O as gs,P as js,Q as Ns,R as Pe,U as vs,V as $e,W as Le,Y as ys,Z as ws}from"./index-DI4YInPS.js";import{T as Ve,a as Ke,b as z,c as B}from"./tabs-D7P84Hx4.js";import{S as K}from"./skeleton-DV0SbO6m.js";import{s as Qe,D as bs}from"./schema-CDsPGLVL.js";import{T as Ss}from"./textarea-BbOWcGDL.js";import{M as De}from"./message-square-CX97MEnf.js";import{S as Ts}from"./send-DjLmzuOp.js";import{B as Ae,G as Ee,N as Cs,S as Fs,H as ks}from"./stock-ai-analysis-D7p_mAi7.js";import{T as _e,a as Ue,b as me,c as E,d as We,e as q}from"./table-Dh8obmbd.js";import{T as ue}from"./trending-down-DrlS2k3i.js";import{D as Ne}from"./dollar-sign-DIwU8lDS.js";import{R as ve,L as ye,a as we}from"./LineChart-UzXyIzcs.js";import{A as ze,a as Be}from"./arrow-up-right-z_vivK5V.js";import{S as qe,a as Ie,b as Me,c as He,d as X}from"./select-CpnPcG5S.js";import{A as Re}from"./arrow-up-down-DSsJmQNo.js";import{f as Ps}from"./format-SREgmwu8.js";import"./arrow-up-DPXP0D04.js";import"./pause-B2oYiJbo.js";import"./index-B-eDo8U8.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=ae("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=ae("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=ae("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=ae("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=ae("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);function Ls(){return Q({queryKey:["/api/portfolio/holdings"],refetchInterval:3e5})}function Ds(){return Q({queryKey:["/api/stocks"],queryFn:async()=>{const s=await ee("GET","/api/stocks",{});return Qe.array().parse(s)},refetchInterval:3e5})}function As(){const{user:s}=ie();return Q({queryKey:["/api/rules",s==null?void 0:s.id],refetchInterval:3e5,enabled:!!s,queryFn:async()=>{const d=await fetch("/api/rules",{credentials:"include"});if(!d.ok)throw new Error("Failed to fetch rules");return d.json()}})}function Es(){return Q({queryKey:["/api/trades"]})}function qs({ticker:s}){const[d,h]=p.useState(""),{toast:P}=xe(),{user:i}=ie(),{data:g=[],isLoading:r}=Q({queryKey:["/api/stocks",s,"comments"],queryFn:()=>fetch(`/api/stocks/${s}/comments`).then(l=>l.json())}),m=G({mutationFn:async l=>{const w=await fetch(`/api/stocks/${s}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!w.ok)throw new Error("Failed to create comment");return await w.json()},onSuccess:()=>{$.invalidateQueries({queryKey:["/api/stocks",s,"comments"]}),$.invalidateQueries({queryKey:["/api/stock-comment-counts"]}),h(""),P({title:"Comment added",description:"Your comment has been posted successfully."})},onError:()=>{P({title:"Error",description:"Failed to post comment. Please try again.",variant:"destructive"})}}),T=l=>{l.preventDefault(),!(!d.trim()||!i)&&m.mutate({userId:i.id,comment:d.trim()})},n=l=>l.split(" ").map(w=>w[0]).join("").toUpperCase().slice(0,2),t=l=>{if(!l)return"just now";const w=typeof l=="string"?new Date(l):l;return ss(w,{addSuffix:!0})};return r?e.jsxs(f,{"data-testid":"card-comments-loading",children:[e.jsx(S,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5"}),"Discussion"]})}),e.jsx(v,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading comments..."})})]}):e.jsxs(f,{"data-testid":"card-stock-comments",children:[e.jsx(S,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5"}),"Discussion (",g.length,")"]})}),e.jsxs(v,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto","data-testid":"container-comments-list",children:g.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4","data-testid":"text-no-comments",children:"No comments yet. Start the discussion!"}):g.map(l=>e.jsxs("div",{className:"flex gap-3 p-3 rounded-md bg-muted/50","data-testid":`comment-${l.id}`,children:[e.jsx(Ze,{className:"h-8 w-8",style:{backgroundColor:l.user.avatarColor},children:e.jsx(es,{className:"text-white",style:{backgroundColor:l.user.avatarColor},children:n(l.user.name)})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-sm font-medium","data-testid":`text-comment-author-${l.id}`,children:l.user.name}),e.jsx("span",{className:"text-xs text-muted-foreground","data-testid":`text-comment-time-${l.id}`,children:t(l.createdAt)})]}),e.jsx("p",{className:"text-sm","data-testid":`text-comment-content-${l.id}`,children:l.comment})]})]},l.id))}),i&&e.jsx("form",{onSubmit:T,className:"space-y-3","data-testid":"form-new-comment",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ss,{value:d,onChange:l=>h(l.target.value),placeholder:"Add your comment...",className:"resize-none text-sm",rows:2,"data-testid":"textarea-comment"}),e.jsx(F,{type:"submit",size:"icon",disabled:!d.trim()||m.isPending,"data-testid":"button-send-comment",className:"h-11 w-11",children:e.jsx(Ts,{className:"h-4 w-4"})})]})})]})]})}function Is({insiderName:s,ticker:d,open:h,onOpenChange:P}){var T;const{data:i,isLoading:g,error:r}=Q({queryKey:[`/api/insider/history/${encodeURIComponent(s||"")}`,d],queryFn:()=>{const n=`/api/insider/history/${encodeURIComponent(s||"")}${d?`?ticker=${d}`:""}`;return fetch(n,{credentials:"include"}).then(t=>{if(!t.ok)throw new Error("Failed to fetch insider trading history");return t.json()})},enabled:h&&!!s});console.log("[InsiderHistory] Dialog state:",{insiderName:s,open:h,isLoading:g,hasError:!!r,hasData:!!i}),r&&console.error("[InsiderHistory] Error:",r);const m=(i==null?void 0:i.trades.reduce((n,t)=>n+t.value,0))||0;return e.jsx(ne,{open:h,onOpenChange:P,children:e.jsxs(le,{className:"max-w-4xl max-h-[90vh]","data-testid":"dialog-insider-history",children:[e.jsxs(ce,{children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5 text-primary"}),e.jsxs("span",{children:["Trading History: ",s]})]}),e.jsx(je,{children:"View historical purchase transactions for this insider"})]}),e.jsxs("div",{className:"space-y-4",children:[(i==null?void 0:i.score)&&i.score.scoredTrades>0&&e.jsx(f,{children:e.jsxs(v,{className:"pt-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl font-semibold font-mono flex items-center gap-2",children:[i.score.successRate.toFixed(1),"%",i.score.successRate>=60?e.jsx(te,{className:"h-4 w-4 text-green-500"}):i.score.successRate>=40?e.jsx(Ye,{className:"h-4 w-4 text-yellow-500"}):e.jsx(ue,{className:"h-4 w-4 text-red-500"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Avg. 2W Gain"}),e.jsxs("p",{className:`text-2xl font-semibold font-mono ${i.score.averageGain>=0?"text-green-600 dark:text-green-500":"text-red-600 dark:text-red-500"}`,children:[i.score.averageGain>=0?"+":"",i.score.averageGain.toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Total P&L"}),e.jsxs("p",{className:`text-2xl font-semibold font-mono ${i.score.totalPnL>=0?"text-green-600 dark:text-green-500":"text-red-600 dark:text-red-500"}`,children:[i.score.totalPnL>=0?"+":"","$",(i.score.totalPnL/1e3).toFixed(1),"k"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Scored Trades"}),e.jsxs("p",{className:"text-2xl font-semibold font-mono",children:[i.score.scoredTrades,"/",i.count]})]})]}),i.score.isPartialData&&i.score.unscoredCount>0&&e.jsxs(Fe,{className:"mt-4",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsxs(ke,{className:"text-xs",children:[i.score.unscoredCount," trade",i.score.unscoredCount>1?"s":""," couldn't be scored (too recent or data unavailable)"]})]})]})}),i&&!((T=i.score)!=null&&T.scoredTrades)&&e.jsx(f,{children:e.jsx(v,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Total Trades"}),e.jsx("p",{className:"text-2xl font-semibold font-mono",children:i.count})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Total Value"}),e.jsxs("p",{className:"text-2xl font-semibold font-mono",children:["$",m.toLocaleString(void 0,{maximumFractionDigits:0})]})]})]})})}),g&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(K,{className:"h-20 w-full"}),e.jsx(K,{className:"h-32 w-full"}),e.jsx(K,{className:"h-32 w-full"})]}),r&&e.jsxs(Fe,{variant:"destructive","data-testid":"alert-insider-history-error",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx(ke,{children:"Failed to load insider trading history. Please try again later."})]}),i&&i.count===0&&e.jsx(f,{children:e.jsx(v,{className:"py-12 text-center text-muted-foreground",children:e.jsx("p",{children:"No recent trading history found for this insider."})})}),i&&i.count>0&&e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(_e,{children:[e.jsx(Ue,{children:e.jsxs(me,{children:[e.jsx(E,{children:"Ticker"}),e.jsx(E,{className:"hidden md:table-cell",children:"Company"}),e.jsx(E,{children:"Trade Date"}),e.jsx(E,{className:"text-right",children:"Price"}),e.jsx(E,{className:"text-right hidden sm:table-cell",children:"Quantity"}),e.jsx(E,{className:"text-right hidden md:table-cell",children:"Value"}),e.jsx(E,{className:"text-right",children:"2W Score"})]})}),e.jsx(We,{children:i.trades.map((n,t)=>e.jsxs(me,{"data-testid":`row-trade-${t}`,children:[e.jsx(q,{className:"font-medium font-mono",children:n.ticker}),e.jsx(q,{className:"max-w-[200px] truncate hidden md:table-cell",title:n.companyName,children:n.companyName}),e.jsx(q,{className:"font-mono text-sm",children:n.tradeDate}),e.jsxs(q,{className:"text-right font-mono",children:["$",n.price.toFixed(2)]}),e.jsx(q,{className:"text-right font-mono hidden sm:table-cell",children:n.quantity.toLocaleString()}),e.jsxs(q,{className:"text-right font-mono font-semibold hidden md:table-cell",children:["$",n.value.toLocaleString(void 0,{maximumFractionDigits:0})]}),e.jsx(q,{className:"text-right",children:n.twoWeekPriceChange!==void 0?e.jsxs(Y,{variant:n.isProfitable?"default":"destructive",className:"font-mono font-semibold","data-testid":`badge-score-${t}`,children:[n.twoWeekPriceChange>=0?"+":"",n.twoWeekPriceChange.toFixed(1),"%"]}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"N/A"})})]},`${n.ticker}-${n.tradeDate}-${t}`))})]})})]})]})})}function Ms({ticker:s,showEmptyState:d=!1}){const{data:h,isLoading:P}=Q({queryKey:["/api/stocks",s,"analysis"],queryFn:async()=>{const n=await fetch(`/api/stocks/${s}/analysis`);if(n.status===404)return null;if(!n.ok)throw new Error("Failed to fetch AI analysis");return n.json()},staleTime:0,refetchInterval:n=>{const t=n.state.data;return t&&(t.status==="pending"||t.status==="analyzing")?3e3:!1}});if(P)return e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground","data-testid":"compact-signal-badge-loading",children:[e.jsx(ts,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Loading signal..."})]});if(!h)return d?e.jsx("div",{className:"text-sm text-muted-foreground","data-testid":"compact-signal-badge-empty",children:"No AI analysis yet. Check the AI Analysis tab to generate one."}):null;const i=h.integratedScore??h.confidenceScore??null;if(i===null)return d?e.jsx("div",{className:"text-sm text-muted-foreground","data-testid":"compact-signal-badge-no-score",children:"Analysis pending..."}):null;const g=n=>n>=70?"text-amber-600 dark:text-amber-400":n>=40?"text-muted-foreground":"text-red-500/70 dark:text-red-400/70",m=h.recommendation==="BUY"?{icon:te,label:"BUY",variant:"default",className:"bg-green-500/10 text-green-600 dark:text-green-400 border-green-500/20"}:h.recommendation==="SELL"?{icon:ue,label:"SELL SHORT",variant:"destructive",className:"bg-red-500/10 text-red-600 dark:text-red-400 border-red-500/20"}:{icon:Ye,label:"HOLD",variant:"secondary",className:""},T=m.icon;return e.jsxs("div",{className:"flex items-center gap-2 flex-wrap","data-testid":"compact-signal-badge",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"AI Signal:"}),e.jsxs("span",{className:`text-sm font-mono font-bold ${g(i)}`,"data-testid":"text-signal-score",children:[i,"/100"]})]}),e.jsxs(Y,{variant:m.variant,className:`gap-1 ${m.className}`,"data-testid":"badge-stance",children:[e.jsx(T,{className:"h-3 w-3"}),m.label]})]})}function Hs({stock:s,open:d,onOpenChange:h,onFollow:P,onReject:i,users:g=[]}){var I,R;const{toast:r}=xe(),{user:m}=ie(),[T,n]=p.useState(!1),[t,l]=p.useState(null),[w,L]=p.useState("overview"),j=p.useRef(null),_=G({mutationFn:async x=>await ee("POST",`/api/stocks/${x}/view`),onSuccess:()=>{m!=null&&m.id&&$.invalidateQueries({queryKey:["/api/stock-views",m.id]})}});p.useEffect(()=>{d&&(s!=null&&s.ticker)&&(L("overview"),m!=null&&m.id&&j.current!==s.ticker&&(j.current=s.ticker,_.mutate(s.ticker))),d||(j.current=null)},[d,s==null?void 0:s.ticker,m==null?void 0:m.id]);const{data:D=[]}=Q({queryKey:["/api/stocks",s==null?void 0:s.ticker,"comments"],queryFn:()=>fetch(`/api/stocks/${s==null?void 0:s.ticker}/comments`).then(x=>x.json()),enabled:!!(s!=null&&s.ticker)}),{data:c=[]}=Q({queryKey:["/api/users/me/followed"],enabled:!!m,retry:!1,meta:{ignoreError:!0}}),o=c.some(x=>x.ticker===(s==null?void 0:s.ticker)),y=G({mutationFn:async x=>{const C=await fetch(`/api/stocks/${x}/follow`,{method:"POST"});if(!C.ok){const Z=await C.json().catch(()=>({}));throw new Error(Z.error||"Failed to follow stock")}return C.json()},onSuccess:()=>{$.invalidateQueries({queryKey:["/api/users/me/followed"]}),$.invalidateQueries({queryKey:["/api/followed-stocks-with-prices"]}),$.invalidateQueries({queryKey:["/api/followed-stocks-with-status"]}),r({title:"Following",description:`Now following ${s==null?void 0:s.ticker}`})},onError:x=>{r({title:"Error",description:x.message||"Failed to follow stock",variant:"destructive"})}}),b=G({mutationFn:async x=>{if(!(await fetch(`/api/stocks/${x}/follow`,{method:"DELETE"})).ok)throw new Error("Failed to unfollow stock")},onSuccess:()=>{$.invalidateQueries({queryKey:["/api/users/me/followed"]}),$.invalidateQueries({queryKey:["/api/followed-stocks-with-prices"]}),$.invalidateQueries({queryKey:["/api/followed-stocks-with-status"]}),r({title:"Success",description:`Unfollowed ${s==null?void 0:s.ticker}`})},onError:()=>{r({title:"Error",description:"Failed to unfollow stock",variant:"destructive"})}});if(!s)return null;const N=parseFloat(s.currentPrice),V=parseFloat(s.previousClose||s.currentPrice),H=N-V,u=H/V*100,A=H>=0,U=s.insiderPrice?parseFloat(s.insiderPrice):N,J=N-U,re=U>0?J/U*100:0,se=["bankruptcy","fraud","investigation","lawsuit","downgrade","loss","scandal"],a=((I=s.news)==null?void 0:I.some(x=>se.some(C=>x.headline.toLowerCase().includes(C))))||!1;return e.jsxs(ne,{open:d,onOpenChange:h,children:[e.jsxs(le,{className:"max-w-4xl max-h-[90vh] overflow-y-auto overflow-x-hidden","data-testid":"dialog-stock-explorer",children:[e.jsx(ce,{children:e.jsxs(oe,{className:"text-2xl font-semibold break-words","data-testid":`text-explorer-title-${s.ticker}`,children:[s.ticker," - ",s.companyName]})}),e.jsxs(Ve,{value:w,onValueChange:L,className:"w-full min-w-0",children:[e.jsxs(Ke,{className:"grid w-full grid-cols-5",children:[e.jsx(z,{value:"overview",children:"Overview"}),e.jsx(z,{value:"ai",children:"AI Analysis"}),e.jsx(z,{value:"details",children:"Details"}),e.jsx(z,{value:"news",children:"News"}),e.jsxs(z,{value:"discussion",children:[e.jsx("span",{children:"Discussion"}),D.length>0&&e.jsx(Y,{variant:"secondary",className:"ml-1.5 h-5 min-w-5 px-1.5",children:D.length})]})]}),e.jsxs(B,{value:"overview",className:"space-y-4",children:[e.jsxs(f,{className:"cursor-pointer hover-elevate active-elevate-2 transition-all",onClick:()=>L("ai"),"data-testid":"card-ai-signal",children:[e.jsx(S,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(k,{className:"text-base",children:"AI Signal"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"View details â†’"})]})}),e.jsx(v,{children:e.jsx(Ms,{ticker:s.ticker,showEmptyState:!0})})]}),(s.description||s.industry||s.marketCap||s.country)&&e.jsxs(f,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(k,{className:"text-base",children:"About the Company"})}),e.jsxs(v,{className:"space-y-3",children:[s.description&&e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:s.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm",children:[s.industry&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.industry})]}),s.marketCap&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ne,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.marketCap})]}),s.country&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.country})]})]})]})]}),e.jsxs(f,{children:[e.jsx(S,{children:e.jsx(k,{className:"text-base",children:"Price Information"})}),e.jsxs(v,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("span",{className:"text-3xl font-mono font-semibold",children:["$",N.toFixed(2)]}),e.jsxs("div",{className:`flex items-center gap-1 ${A?"text-success":"text-destructive"}`,children:[A?e.jsx(te,{className:"h-4 w-4"}):e.jsx(ue,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm font-medium",children:[A?"+":"",H.toFixed(2)," (",u.toFixed(2),"%)"]})]})]}),s.priceHistory&&s.priceHistory.length>0&&e.jsx("div",{className:"h-20 w-full",children:e.jsx(ve,{width:"100%",height:"100%",children:e.jsx(ye,{data:s.priceHistory,children:e.jsx(we,{type:"monotone",dataKey:"price",stroke:A?"hsl(var(--success))":"hsl(var(--destructive))",strokeWidth:2,dot:!1})})})})]})]}),s.insiderPrice&&e.jsxs(f,{children:[e.jsx(S,{children:e.jsx(k,{className:"text-base",children:"Insider Transaction"})}),e.jsx(v,{className:"space-y-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-muted-foreground",children:"Insider"}),e.jsxs(as,{children:[e.jsx(is,{asChild:!0,children:e.jsx("button",{type:"button",className:"inline-flex items-center justify-center focus:outline-none focus-visible:ring-1 focus-visible:ring-ring rounded-sm","aria-label":"Insider info","data-testid":"button-insider-info",children:e.jsx(Ge,{className:"h-3 w-3 text-muted-foreground cursor-help"})})}),e.jsx(rs,{children:e.jsx("p",{children:"Click the name to see their trading history"})})]})]}),s.insiderName?e.jsx(F,{variant:"ghost",className:"h-auto p-0 font-medium text-primary hover:underline justify-start",onClick:()=>{l(s.insiderName),n(!0)},"data-testid":"button-insider-name",children:s.insiderName}):e.jsx("p",{className:"font-medium",children:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Title"}),e.jsx("p",{className:"font-medium",children:s.insiderTitle||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Purchase Price"}),e.jsxs("p",{className:"font-mono font-medium",children:["$",U.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Quantity"}),e.jsx("p",{className:"font-mono font-medium",children:((R=s.insiderQuantity)==null?void 0:R.toLocaleString())||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Trade Date"}),e.jsx("p",{className:"font-medium",children:s.insiderTradeDate||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Current vs Insider"}),e.jsxs("div",{className:`flex items-center gap-1 ${J>=0?"text-success":"text-destructive"}`,children:[J>=0?e.jsx(ze,{className:"h-3 w-3"}):e.jsx(Be,{className:"h-3 w-3"}),e.jsxs("span",{className:"font-mono text-sm font-medium",children:[J>=0?"+":"",re.toFixed(2),"%"]})]})]})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(F,{variant:o?"outline":"default",className:"flex-1",onClick:()=>{o?b.mutate(s.ticker):y.mutate(s.ticker)},disabled:y.isPending||b.isPending,"data-testid":`button-explorer-follow-${s.ticker}`,children:[e.jsx(ns,{className:`h-4 w-4 mr-2 ${o?"fill-current":""}`}),y.isPending?"Following...":b.isPending?"Unfollowing...":o?"Unfollow":"Follow"]}),e.jsxs(F,{variant:"outline",className:"flex-1",onClick:()=>i==null?void 0:i(s),"data-testid":`button-explorer-reject-${s.ticker}`,children:[e.jsx(ls,{className:"h-4 w-4 mr-2"}),"Reject"]})]})]}),e.jsx(B,{value:"details",className:"space-y-4",children:(s.description||s.industry||s.country)&&e.jsxs(f,{children:[e.jsx(S,{children:e.jsx(k,{className:"text-base",children:"Company Information"})}),e.jsxs(v,{className:"space-y-3",children:[s.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[s.industry&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.industry})]}),s.country&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.country})]}),s.ipo&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["IPO: ",s.ipo]})]}),s.marketCap&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.marketCap})]})]})]})]})}),e.jsx(B,{value:"news",className:"space-y-4",children:s.news&&s.news.length>0&&e.jsxs(f,{children:[e.jsx(S,{children:e.jsxs(k,{className:"text-base flex items-center gap-2",children:[e.jsx(Cs,{className:"h-5 w-5"}),"Latest News"]})}),e.jsxs(v,{className:"space-y-2",children:[a&&s.recommendation==="buy"&&e.jsx("div",{className:"mb-3 rounded-md bg-destructive/10 border border-destructive/20 p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(de,{className:"h-4 w-4 text-destructive shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-destructive-foreground",children:[e.jsx("span",{className:"font-semibold",children:"Warning:"})," Negative news detected. Review carefully before purchasing."]})]})}),s.news.map((x,C)=>{const Z=se.some(be=>x.headline.toLowerCase().includes(be));return e.jsx("a",{href:x.url,target:"_blank",rel:"noopener noreferrer",className:"block rounded-md bg-muted/50 p-3 hover-elevate","data-testid":`link-explorer-news-${C}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[Z&&e.jsx(de,{className:"h-4 w-4 text-destructive shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-sm font-medium mb-1 ${Z?"text-destructive":""}`,children:x.headline}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mb-2",children:x.summary}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:x.source}),e.jsx("span",{children:new Date(x.datetime*1e3).toLocaleDateString()})]})]}),e.jsx(os,{className:"h-4 w-4 text-muted-foreground shrink-0 mt-0.5"})]})},C)})]})]})}),e.jsx(B,{value:"ai",className:"w-full max-w-full min-w-0 overflow-hidden",children:e.jsx("div",{className:"w-full max-w-full min-w-0",children:e.jsx(Fs,{ticker:s.ticker})})}),e.jsx(B,{value:"discussion",children:e.jsx(qs,{ticker:s.ticker})})]})]}),e.jsx(Is,{insiderName:t,ticker:(s==null?void 0:s.ticker)||null,open:T,onOpenChange:n})]})}function Rs({holdings:s,stocks:d,isLoading:h}){const{toast:P}=xe(),[i,g]=p.useState(!1),[r,m]=p.useState(null),[T,n]=p.useState(!1),[t,l]=p.useState(null),[w,L]=p.useState(null),j=G({mutationFn:async c=>{const o=await ee("GET",`/api/stocks/${c}`,{});return Qe.parse(o)},onSuccess:c=>{$.setQueryData(["/api/stocks"],o=>o?o.some(b=>b.ticker===c.ticker)?o.map(b=>b.ticker===c.ticker?c:b):[...o,c]:[c]),l(c),n(!0),L(null)},onError:(c,o)=>{L(null),P({title:"Unable to load stock details",description:`Could not find data for ${o}. It may not be in our system yet.`,variant:"destructive"})}}),_=(c,o)=>{if(w===c)return;const y=$.getQueryData(["/api/stocks"]),b=y==null?void 0:y.find(N=>N.ticker===c);b?(l(b),n(!0)):o?(l(o),n(!0)):(L(c),j.mutate(c))},D=G({mutationFn:async c=>{await ee("DELETE",`/api/portfolio/holdings/${c}`,{})},onSuccess:()=>{$.invalidateQueries({queryKey:["/api/portfolio/holdings"]}),P({title:"Holding Removed",description:`${r==null?void 0:r.ticker} has been removed from your portfolio.`}),g(!1),m(null)},onError:c=>{P({title:"Delete Failed",description:c.message||"Failed to remove holding. Please try again.",variant:"destructive"})}});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Your Holdings"}),e.jsx(F,{variant:"outline",size:"sm",asChild:!0,"data-testid":"button-view-all-stocks",children:e.jsx(ge,{href:"/recommendations",children:"View Recommendations"})})]}),!s||s.length===0?e.jsx(f,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Je,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Holdings Yet"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Start building your portfolio by purchasing stocks"}),e.jsx(F,{asChild:!0,"data-testid":"button-browse-stocks",children:e.jsx(ge,{href:"/recommendations",children:"Browse Stock Recommendations"})})]})}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:s.map(c=>{var H;const o=d==null?void 0:d.find(u=>u.ticker===c.ticker),y=parseFloat(c.profitLoss||"0"),b=parseFloat(c.profitLossPercent||"0"),N=y>=0,V=((H=o==null?void 0:o.priceHistory)==null?void 0:H.slice(-7))||[];return e.jsxs(f,{className:`hover-elevate cursor-pointer ${w===c.ticker?"opacity-50":""}`,"data-testid":`card-holding-${c.ticker}`,onClick:()=>_(c.ticker,o),children:[e.jsxs(S,{className:"flex flex-row items-center justify-between gap-1 space-y-0 pb-3",children:[e.jsxs("div",{children:[e.jsx(k,{className:"text-lg font-semibold",children:c.ticker}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(o==null?void 0:o.companyName)||"Loading..."})]}),e.jsxs(Y,{variant:N?"default":"destructive",className:"font-mono text-xs",children:[N?"+":"",b.toFixed(2),"%"]})]}),e.jsxs(v,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Current Price"}),e.jsxs("p",{className:"text-xl font-mono font-semibold",children:["$",(o==null?void 0:o.currentPrice)||"0.00"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Quantity"}),e.jsx("p",{className:"text-xl font-mono font-semibold",children:c.quantity})]})]}),V.length>0&&e.jsx("div",{className:"h-12",children:e.jsx(ve,{width:"100%",height:"100%",children:e.jsx(ye,{data:V,children:e.jsx(we,{type:"monotone",dataKey:"price",stroke:N?"hsl(var(--success))":"hsl(var(--destructive))",strokeWidth:2,dot:!1})})})}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Value"}),e.jsxs("p",{className:"text-base font-mono font-medium",children:["$",parseFloat(c.currentValue||"0").toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"P&L"}),e.jsxs("p",{className:`text-base font-mono font-medium ${N?"text-success":"text-destructive"}`,children:[N?"+":"","$",Math.abs(y).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",onClick:u=>u.stopPropagation(),children:[e.jsx(F,{variant:"outline",size:"sm",className:"flex-1",asChild:!0,"data-testid":`button-view-rules-${c.ticker}`,children:e.jsxs(ge,{href:`/trading?tab=rules&ticker=${c.ticker}`,children:[e.jsx(ds,{className:"h-4 w-4 mr-1"}),"Rules"]})}),e.jsx(F,{variant:"outline",size:"sm",onClick:u=>{u.stopPropagation(),m(c),g(!0)},"data-testid":`button-remove-${c.ticker}`,title:"Remove from watchlist",children:e.jsx(ms,{className:"h-4 w-4"})})]})]})]},c.id)})})]}),e.jsx(xs,{open:i,onOpenChange:g,children:e.jsxs(us,{children:[e.jsxs(hs,{children:[e.jsx(ps,{children:"Remove from Watchlist?"}),e.jsxs(fs,{children:["Are you sure you want to remove ",e.jsx("strong",{children:r==null?void 0:r.ticker})," from your watchlist? You can always add it back later. Your trade history will not be affected."]})]}),e.jsxs(gs,{children:[e.jsx(js,{children:"Cancel"}),e.jsx(Ns,{onClick:()=>{r&&D.mutate(r.id)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remove"})]})]})}),e.jsx(Hs,{stock:t,open:T,onOpenChange:n})]})}function Os({holdings:s,stocks:d,rules:h,isLoading:P}){var J,re,se;const{user:i}=ie(),{toast:g}=xe(),[r,m]=p.useState(null),[T,n]=p.useState(!1),[t,l]=p.useState(0),[w,L]=p.useState(!1),[j,_]=p.useState(null),[D,c]=p.useState(""),o=G({mutationFn:async({id:a,value:I})=>{const R=h==null?void 0:h.find(C=>C.id===a);if(!R||!R.conditions||R.conditions.length===0)return;const x=[...R.conditions];return x[0]={...x[0],value:I},await ee("PATCH",`/api/rules/${a}`,{conditions:x})},onSuccess:()=>{$.invalidateQueries({queryKey:["/api/rules",i==null?void 0:i.id]}),g({title:"Rule Updated",description:"Trading rule boundary has been updated successfully"}),n(!1)},onError:()=>{g({title:"Error",description:"Failed to update trading rule",variant:"destructive"})}}),y=G({mutationFn:async({ticker:a,quantity:I})=>await ee("POST","/api/ibkr/trade",{ticker:a,action:"sell",quantity:I}),onSuccess:()=>{$.invalidateQueries({queryKey:["/api/portfolio/holdings"]}),$.invalidateQueries({queryKey:["/api/stocks"]}),g({title:"Stock Sold",description:"Successfully sold shares"}),L(!1),_(null),c("")},onError:()=>{g({title:"Error",description:"Failed to sell shares. Please try again.",variant:"destructive"})}}),b=a=>{!a.conditions||a.conditions.length===0||(m(a),l(a.conditions[0].value),n(!0))},N=()=>{r&&o.mutate({id:r.id,value:t})},V=a=>{_(a),c(String(a.quantity)),L(!0)},H=()=>{if(!j)return;const a=parseInt(D);if(isNaN(a)||a<=0||a>j.quantity){g({title:"Invalid Quantity",description:`Please enter a valid quantity between 1 and ${j.quantity}`,variant:"destructive"});return}y.mutate({ticker:j.ticker,quantity:a})};if(!s||s.length===0)return e.jsx(f,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Pe,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2","data-testid":"text-no-holdings",children:"No Portfolio Holdings"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Purchase stocks to start managing your portfolio with automated rules"})]})});const u=p.useMemo(()=>{if(!s||!d||!h)return{triggered:[],nearTrigger:[]};const a=[],I=[];return s.forEach(R=>{const x=d.find(M=>M.ticker===R.ticker);if(!x)return;const C=parseFloat(x.currentPrice),Z=parseFloat(R.averagePurchasePrice);h.filter(M=>M.enabled&&(M.action==="sell"||M.action==="sell_all")&&(M.scope==="all_holdings"||M.scope==="specific_stock"&&M.ticker===x.ticker)).forEach(M=>{if(!M.conditions||M.conditions.length===0)return;const O=M.conditions[0];let W=0;O.metric==="price_change_percent"?W=Z*(1+O.value/100):O.metric==="price_change_from_close_percent"?W=parseFloat(x.previousClose||x.currentPrice)*(1+O.value/100):O.metric==="price_absolute"&&(W=O.value);const Se=O.operator==="<"||O.operator==="<=",Xe=O.operator===">"||O.operator===">=",he=(C-W)/W*100,Te=5;let pe=!1,fe=!1;Se?C<=W?pe=!0:Math.abs(he)<=Te&&(fe=!0):Xe&&(C>=W?pe=!0:Math.abs(he)<=Te&&(fe=!0));const Ce={ticker:x.ticker,companyName:x.companyName,currentPrice:C,triggerPrice:W,alertType:Se?"stop_loss":"take_profit",rule:M,percentFromTrigger:he,holding:R};pe?a.push(Ce):fe&&I.push(Ce)})}),{triggered:a,nearTrigger:I}},[s,d,h]),[A,U]=p.useState(!0);return e.jsxs(e.Fragment,{children:[e.jsxs(f,{"data-testid":"card-active-alerts",children:[e.jsx(S,{children:e.jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx(k,{children:"Active Alerts"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Stocks that have triggered or are approaching your trading rules"})]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>U(!A),"data-testid":"button-toggle-near-trigger",children:[A?"Hide":"Show"," Near-Trigger"]})]})}),e.jsxs(v,{children:[u.triggered.length>0&&e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4 text-destructive"}),e.jsxs("h3",{className:"text-sm font-semibold",children:["Triggered Alerts (",u.triggered.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:u.triggered.map((a,I)=>e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-3 p-4 rounded-md border bg-card hover-elevate","data-testid":`alert-triggered-${a.ticker}`,children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"flex items-start justify-between gap-2",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold",children:a.ticker}),e.jsx(Y,{variant:a.alertType==="stop_loss"?"destructive":"default",children:a.alertType==="stop_loss"?"Stop Loss":"Take Profit"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.companyName})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Current:"}),e.jsxs("span",{className:"ml-1 font-mono font-semibold",children:["$",a.currentPrice.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Trigger:"}),e.jsxs("span",{className:"ml-1 font-mono",children:["$",a.triggerPrice.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"From Trigger:"}),e.jsxs("span",{className:`ml-1 font-mono font-semibold ${a.alertType==="stop_loss"?"text-destructive":"text-success"}`,children:[a.percentFromTrigger>0?"+":"",a.percentFromTrigger.toFixed(2),"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Shares:"}),e.jsx("span",{className:"ml-1 font-mono",children:a.holding.quantity})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>b(a.rule),"data-testid":`button-edit-rule-${a.ticker}`,children:[e.jsx(Oe,{className:"h-3 w-3 mr-1"}),"Edit Rule"]}),e.jsx(F,{variant:"default",size:"sm",onClick:()=>V(a.holding),"data-testid":`button-sell-${a.ticker}`,children:"Sell"})]})]},`triggered-${I}`))})]}),A&&u.nearTrigger.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("h3",{className:"text-sm font-semibold",children:["Near-Trigger Alerts (",u.nearTrigger.length,")"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"(Within 5% of trigger)"})]}),e.jsx("div",{className:"space-y-2",children:u.nearTrigger.map((a,I)=>e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-3 p-4 rounded-md border bg-card hover-elevate","data-testid":`alert-near-${a.ticker}`,children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"flex items-start justify-between gap-2",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold",children:a.ticker}),e.jsx(Y,{variant:"outline",children:a.alertType==="stop_loss"?"Stop Loss":"Take Profit"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.companyName})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Current:"}),e.jsxs("span",{className:"ml-1 font-mono font-semibold",children:["$",a.currentPrice.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Trigger:"}),e.jsxs("span",{className:"ml-1 font-mono",children:["$",a.triggerPrice.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"From Trigger:"}),e.jsxs("span",{className:"ml-1 font-mono",children:[a.percentFromTrigger>0?"+":"",a.percentFromTrigger.toFixed(2),"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Shares:"}),e.jsx("span",{className:"ml-1 font-mono",children:a.holding.quantity})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>b(a.rule),"data-testid":`button-edit-rule-${a.ticker}`,children:[e.jsx(Oe,{className:"h-3 w-3 mr-1"}),"Edit Rule"]})})]},`near-${I}`))})]}),u.triggered.length===0&&(A?u.nearTrigger.length===0:!0)&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(vs,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2","data-testid":"text-no-alerts",children:"No Active Alerts"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"All your stocks are within safe trading ranges. Check back regularly for updates."})]})]})]}),e.jsx(ne,{open:T,onOpenChange:n,children:e.jsxs(le,{"data-testid":"dialog-adjust-rule",children:[e.jsxs(ce,{children:[e.jsx(oe,{children:"Adjust Sell Boundary"}),e.jsxs(je,{children:["Move the ",(J=r==null?void 0:r.conditions)!=null&&J[0]&&(r.conditions[0].operator==="<"||r.conditions[0].operator==="<=")?"stop-loss":"take-profit"," line by changing the trigger value"]})]}),r&&r.conditions&&r.conditions.length>0&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:r.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.scope==="all_holdings"?"Applies to all holdings":`Applies to ${r.ticker}`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs($e,{htmlFor:"trigger-value",children:["Trigger Value ",r.conditions[0].metric.includes("percent")?"(%)":"($)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{id:"trigger-value",type:"number",step:"any",value:t,onChange:a=>l(parseFloat(a.target.value)||0),className:"font-mono","data-testid":"input-trigger-value"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:r.conditions[0].operator})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.conditions[0].metric==="price_change_percent"&&"Percentage change from purchase price (negative = loss, positive = gain)",r.conditions[0].metric==="price_change_from_close_percent"&&"Percentage change from previous day's close",r.conditions[0].metric==="price_absolute"&&"Absolute price level in dollars"]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(F,{variant:"outline",className:"flex-1",onClick:()=>n(!1),"data-testid":"button-cancel-adjust",children:"Cancel"}),e.jsx(F,{className:"flex-1",onClick:N,disabled:o.isPending,"data-testid":"button-save-adjust",children:o.isPending?"Saving...":"Save Changes"})]})]})]})}),e.jsx(ne,{open:w,onOpenChange:L,children:e.jsxs(le,{"data-testid":"dialog-sell-stock",children:[e.jsxs(ce,{children:[e.jsx(oe,{children:"Sell Shares"}),e.jsx(je,{children:j&&d&&e.jsxs(e.Fragment,{children:["Sell shares of ",j.ticker," (",(re=d.find(a=>a.ticker===j.ticker))==null?void 0:re.companyName,")"]})})]}),j&&d&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($e,{htmlFor:"sell-quantity",children:"Quantity (shares)"}),e.jsx(Le,{id:"sell-quantity",type:"number",min:"1",max:j.quantity,value:D,onChange:a=>c(a.target.value),className:"font-mono","data-testid":"input-sell-quantity"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["You currently hold ",j.quantity," shares. Max: ",j.quantity]})]}),e.jsxs("div",{className:"rounded-md bg-muted p-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm",children:"Current Price"}),e.jsxs("span",{className:"font-mono font-semibold","data-testid":"text-sell-price",children:["$",parseFloat(((se=d.find(a=>a.ticker===j.ticker))==null?void 0:se.currentPrice)||"0").toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Estimated Total"}),e.jsxs("span",{className:"text-lg font-mono font-semibold","data-testid":"text-sell-total",children:["$",D&&d.find(a=>a.ticker===j.ticker)?(parseFloat(d.find(a=>a.ticker===j.ticker).currentPrice)*parseInt(D)).toFixed(2):"0.00"]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{type:"button",variant:"outline",className:"flex-1",onClick:()=>L(!1),"data-testid":"button-cancel-sell",children:"Cancel"}),e.jsx(F,{type:"button",variant:"destructive",className:"flex-1",onClick:H,disabled:y.isPending,"data-testid":"button-confirm-sell",children:y.isPending?"Selling...":"Confirm Sell"})]})]})})]})}function Vs({trades:s,isLoading:d}){const[h,P]=p.useState("all"),[i,g]=p.useState("all"),r=(s==null?void 0:s.filter(t=>{const l=h==="all"||t.type===h,w=i==="all"||t.status===i;return l&&w}))||[],m=(s==null?void 0:s.filter(t=>t.type==="buy").reduce((t,l)=>t+parseFloat(l.total),0))||0,T=(s==null?void 0:s.filter(t=>t.type==="sell").reduce((t,l)=>t+parseFloat(l.total),0))||0,n=t=>t==="completed"?"default":t==="pending"?"secondary":"destructive";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(f,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between gap-1 space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Total Purchases"}),e.jsx(Re,{className:"h-4 w-4 text-success"})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"text-3xl font-mono font-semibold text-success",children:["$",m.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Buy orders executed"})]})]}),e.jsxs(f,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between gap-1 space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Total Sales"}),e.jsx(Re,{className:"h-4 w-4 text-destructive"})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"text-3xl font-mono font-semibold text-destructive",children:["$",T.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Sell orders executed"})]})]})]}),e.jsxs(f,{children:[e.jsx(S,{children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsx(k,{children:"Transaction History"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(qe,{value:h,onValueChange:t=>P(t),children:[e.jsx(Ie,{className:"w-32","data-testid":"select-filter-type",children:e.jsx(Me,{placeholder:"Type"})}),e.jsxs(He,{children:[e.jsx(X,{value:"all",children:"All Types"}),e.jsx(X,{value:"buy",children:"Buy"}),e.jsx(X,{value:"sell",children:"Sell"})]})]}),e.jsxs(qe,{value:i,onValueChange:t=>g(t),children:[e.jsx(Ie,{className:"w-40","data-testid":"select-filter-status",children:e.jsx(Me,{placeholder:"Status"})}),e.jsxs(He,{children:[e.jsx(X,{value:"all",children:"All Status"}),e.jsx(X,{value:"completed",children:"Completed"}),e.jsx(X,{value:"pending",children:"Pending"}),e.jsx(X,{value:"failed",children:"Failed"})]})]}),e.jsxs(F,{variant:"outline",size:"sm","data-testid":"button-export",children:[e.jsx(bs,{className:"h-4 w-4 mr-2"}),"Export"]})]})]})}),e.jsx(v,{children:!r||r.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ks,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Trades Found"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s&&s.length>0?"No trades match your current filters":"Start trading to see your transaction history"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(_e,{children:[e.jsx(Ue,{children:e.jsxs(me,{children:[e.jsx(E,{className:"min-w-[140px]",children:"Date"}),e.jsx(E,{className:"min-w-[70px]",children:"Stock"}),e.jsx(E,{className:"min-w-[70px]",children:"Type"}),e.jsx(E,{className:"text-right hidden md:table-cell min-w-[80px]",children:"Quantity"}),e.jsx(E,{className:"text-right hidden sm:table-cell min-w-[80px]",children:"Price"}),e.jsx(E,{className:"text-right min-w-[90px]",children:"Total"}),e.jsx(E,{className:"min-w-[90px]",children:"Status"})]})}),e.jsx(We,{children:r.map(t=>e.jsxs(me,{"data-testid":`row-trade-${t.id}`,children:[e.jsx(q,{className:"text-sm",children:t.executedAt?Ps(new Date(t.executedAt),"MMM dd, yyyy HH:mm"):"-"}),e.jsx(q,{className:"font-medium",children:t.ticker}),e.jsx(q,{children:e.jsx(Y,{variant:t.type==="buy"?"default":"secondary",className:"uppercase",children:t.type})}),e.jsx(q,{className:"text-right font-mono hidden md:table-cell",children:t.quantity}),e.jsxs(q,{className:"text-right font-mono hidden sm:table-cell",children:["$",parseFloat(t.price).toFixed(2)]}),e.jsxs(q,{className:"text-right font-mono font-medium",children:["$",parseFloat(t.total).toFixed(2)]}),e.jsx(q,{children:e.jsx(Y,{variant:n(t.status),children:t.status})})]},t.id))})]})})})]})]})}function ct(){const[,s]=ys(),{user:d,experienceState:h}=ie(),[P,i]=p.useState(!1),r=new URLSearchParams(window.location.search).get("tab")||"overview",[m,T]=p.useState(r);p.useEffect(()=>{const u=()=>{const U=new URLSearchParams(window.location.search).get("tab")||"overview";T(U)};return window.addEventListener("popstate",u),window.addEventListener("urlchange",u),()=>{window.removeEventListener("popstate",u),window.removeEventListener("urlchange",u)}},[]);const n=u=>{T(u),s(`/watchlist?tab=${u}`),window.dispatchEvent(new Event("urlchange"))};p.useEffect(()=>{h==="onboarding_pending"&&i(!0)},[h]);const{data:t,isLoading:l}=Ls(),{data:w,isLoading:L}=Ds(),{data:j,isLoading:_}=As(),{data:D,isLoading:c}=Es(),o=(t==null?void 0:t.reduce((u,A)=>u+parseFloat(A.currentValue||"0"),0))||0,y=(t==null?void 0:t.reduce((u,A)=>u+parseFloat(A.profitLoss||"0"),0))||0,b=o>0?y/(o-y)*100:0,N=y>=0,V=[{value:o*.92},{value:o*.94},{value:o*.91},{value:o*.96},{value:o*.98},{value:o}],H=l||L;return H?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx(K,{className:"h-8 w-48 mb-2"}),e.jsx(K,{className:"h-4 w-96"})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map(u=>e.jsxs(f,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(K,{className:"h-4 w-24"}),e.jsx(K,{className:"h-4 w-4"})]}),e.jsxs(v,{children:[e.jsx(K,{className:"h-8 w-32 mb-2"}),e.jsx(K,{className:"h-3 w-20"})]})]},u))})]}):e.jsxs(e.Fragment,{children:[e.jsx(ws,{open:P,onOpenChange:i,onComplete:()=>i(!1)}),e.jsxs("div",{className:"p-4 md:p-6 space-y-4 md:space-y-6 max-w-7xl",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h1",{className:"text-xl font-semibold whitespace-nowrap","data-testid":"text-page-title",children:"Watchlist"})}),e.jsxs("div",{className:"grid gap-4 md:gap-6 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(f,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between gap-1 space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Tracked Value"}),e.jsx($s,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"text-2xl md:text-3xl font-mono font-semibold","data-testid":"text-tracked-value",children:["$",o.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("div",{className:"mt-2 md:mt-3 h-8 md:h-12",children:e.jsx(ve,{width:"100%",height:"100%",children:e.jsx(ye,{data:V,children:e.jsx(we,{type:"monotone",dataKey:"value",stroke:"hsl(var(--primary))",strokeWidth:2,dot:!1})})})})]})]}),e.jsxs(f,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between gap-1 space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Total P&L"}),N?e.jsx(te,{className:"h-4 w-4 text-success"}):e.jsx(ue,{className:"h-4 w-4 text-destructive"})]}),e.jsxs(v,{children:[e.jsxs("div",{className:`text-2xl md:text-3xl font-mono font-semibold ${N?"text-success":"text-destructive"}`,"data-testid":"text-total-pl",children:[N?"+":"","$",Math.abs(y).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[N?e.jsx(ze,{className:"h-4 w-4 text-success"}):e.jsx(Be,{className:"h-4 w-4 text-destructive"}),e.jsxs("span",{className:`text-sm font-mono font-medium ${N?"text-success":"text-destructive"}`,children:[N?"+":"",b.toFixed(2),"%"]})]})]})]}),e.jsxs(f,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between gap-1 space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Tracked Stocks"}),e.jsx(Je,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl md:text-3xl font-mono font-semibold","data-testid":"text-tracked-count",children:(t==null?void 0:t.length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Currently tracking"})]})]}),e.jsxs(f,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between gap-1 space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Total Trades"}),e.jsx(Ne,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl md:text-3xl font-mono font-semibold",children:(D==null?void 0:D.length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"All time transactions"})]})]})]}),e.jsxs(Ve,{value:m,onValueChange:n,className:"space-y-4 md:space-y-6",children:[e.jsxs(Ke,{className:"w-full grid grid-cols-3","data-testid":"tabs-watchlist",children:[e.jsx(z,{value:"overview","data-testid":"tab-tracked-stocks",title:"View tracked stocks and current values",children:"Tracked Stocks"}),e.jsx(z,{value:"management","data-testid":"tab-active-alerts",title:"Monitor stocks with triggered sell alerts",children:"Active Alerts"}),e.jsx(z,{value:"history","data-testid":"tab-history",title:"View complete trade history and transactions",children:"History"})]}),e.jsx(B,{value:"overview",className:"space-y-4 md:space-y-6",forceMount:!0,hidden:m!=="overview",children:e.jsx(Rs,{holdings:t||[],stocks:w||[],isLoading:H})}),e.jsx(B,{value:"management",className:"space-y-6",forceMount:!0,hidden:m!=="management",children:e.jsx(Os,{holdings:t||[],stocks:w||[],rules:j||[],isLoading:H||_})}),e.jsx(B,{value:"history",className:"space-y-6",forceMount:!0,hidden:m!=="history",children:e.jsx(Vs,{trades:D||[],isLoading:c})})]})]})]})}export{ct as default};
