import{a as $,r as c,u as d,j as e,W as F,a6 as y,C as u,h as x,G as h,B as j,f as M,g as q,a7 as U,v as w,a0 as E,F as H}from"./index-DI4YInPS.js";import{S}from"./skeleton-DV0SbO6m.js";import{T as K,a as A,b as C,c as v}from"./tabs-D7P84Hx4.js";import{T as D,a as I,b as T,c as r,d as R,e as n}from"./table-Dh8obmbd.js";import{S as V}from"./search-DL_GMNbq.js";import{M as g}from"./message-square-CX97MEnf.js";function X(){const{user:o}=$(),[i,k]=c.useState(""),[B,L]=c.useState("discussions"),{data:p=[],isLoading:P}=d({queryKey:["/api/stock-comment-counts"],enabled:!!o}),{data:f=[]}=d({queryKey:["/api/stocks/with-user-status"],enabled:!!o}),{data:N=[]}=d({queryKey:["/api/stock-analyses"],enabled:!!o}),l=c.useMemo(()=>p.filter(s=>s.count>0).map(s=>{const t=f.find(m=>m.ticker===s.ticker),a=N.find(m=>m.ticker===s.ticker);return{ticker:s.ticker,companyName:t==null?void 0:t.companyName,commentCount:s.count,currentPrice:t==null?void 0:t.currentPrice,integratedScore:a==null?void 0:a.integratedScore}}).sort((s,t)=>t.commentCount-s.commentCount),[p,f,N]),b=c.useMemo(()=>{if(!i.trim())return l;const s=i.toUpperCase();return l.filter(t=>{var a;return t.ticker.includes(s)||((a=t.companyName)==null?void 0:a.toUpperCase().includes(s))})},[l,i]);return P?e.jsxs("div",{className:"p-4 md:p-6 space-y-4",children:[e.jsx(S,{className:"h-8 w-48"}),e.jsx(S,{className:"h-64 w-full"})]}):e.jsxs("div",{className:"p-4 md:p-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h1",{className:"text-xl font-semibold whitespace-nowrap","data-testid":"text-page-title",children:"Community"})}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground"}),e.jsx(F,{placeholder:"Search...",value:i,onChange:s=>k(s.target.value),className:"pl-8 h-8 w-32 text-sm","data-testid":"input-search-ticker"})]})]}),e.jsxs(K,{value:B,onValueChange:L,children:[e.jsxs(A,{children:[e.jsxs(C,{value:"discussions","data-testid":"tab-discussions",children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"Top Discussed"]}),e.jsxs(C,{value:"suggestions","data-testid":"tab-suggestions",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Feature Ideas"]})]}),e.jsx(v,{value:"discussions",className:"mt-4",children:b.length===0?e.jsx(u,{children:e.jsxs(x,{className:"py-12 text-center",children:[e.jsx(g,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No discussions yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Be the first to start a discussion on a stock"}),e.jsx(h,{href:"/opportunities",children:e.jsx(j,{"data-testid":"button-browse-stocks",children:"Browse Stocks"})})]})}):e.jsxs(u,{children:[e.jsx(M,{className:"pb-2",children:e.jsxs(q,{className:"text-base flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Most Discussed Stocks"]})}),e.jsx(x,{className:"p-0",children:e.jsxs(D,{children:[e.jsx(I,{children:e.jsxs(T,{children:[e.jsx(r,{className:"w-16",children:"#"}),e.jsx(r,{className:"w-24",children:"Ticker"}),e.jsx(r,{children:"Company"}),e.jsx(r,{className:"text-right",children:"Price"}),e.jsx(r,{className:"text-center",children:"Signal"}),e.jsx(r,{className:"text-center",children:"Comments"}),e.jsx(r,{className:"text-right",children:"Actions"})]})}),e.jsx(R,{children:b.map((s,t)=>e.jsxs(T,{className:"hover-elevate cursor-pointer",onClick:()=>window.location.href=`/ticker/${s.ticker}?from=community`,"data-testid":`row-discussion-${s.ticker}`,children:[e.jsx(n,{className:"font-mono text-muted-foreground",children:t+1}),e.jsx(n,{children:e.jsx("span",{className:"font-mono font-medium",children:s.ticker})}),e.jsx(n,{className:"text-muted-foreground truncate max-w-32",children:s.companyName||"-"}),e.jsx(n,{className:"text-right font-mono",children:s.currentPrice?`$${parseFloat(s.currentPrice).toFixed(2)}`:"-"}),e.jsx(n,{className:"text-center",children:s.integratedScore!=null?e.jsx(w,{className:E("font-mono",s.integratedScore>=90&&"bg-amber-500 text-white",s.integratedScore>=70&&s.integratedScore<90&&"bg-amber-100 text-amber-700 dark:bg-amber-950 dark:text-amber-400",s.integratedScore>=50&&s.integratedScore<70&&"bg-secondary",s.integratedScore<50&&"bg-secondary text-muted-foreground"),children:s.integratedScore}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(n,{className:"text-center",children:e.jsxs(w,{variant:"secondary",className:"font-mono",children:[e.jsx(g,{className:"h-3 w-3 mr-1"}),s.commentCount]})}),e.jsx(n,{className:"text-right",onClick:a=>a.stopPropagation(),children:e.jsx(h,{href:`/ticker/${s.ticker}?from=community`,children:e.jsx(j,{size:"sm",variant:"ghost","data-testid":`button-view-${s.ticker}`,children:e.jsx(H,{className:"h-3 w-3"})})})})]},s.ticker))})]})})]})}),e.jsx(v,{value:"suggestions",className:"mt-4",children:e.jsx(u,{children:e.jsxs(x,{className:"py-12 text-center",children:[e.jsx(y,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Feature Suggestions"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Share your ideas for improving signal2"}),e.jsx(h,{href:"/community/feature-suggestions",children:e.jsx(j,{"data-testid":"button-view-suggestions",children:"View Suggestions"})})]})})})]})]})}export{X as default};
