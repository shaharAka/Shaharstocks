import{d as R,a as H,Y as J,r as d,u as z,e as E,j as e,w as N,x as w,B as o,a4 as Y,y,W as G,C as W,h as V,S as B,G as $,v as u,a0 as D,T as X,q as g,b as K}from"./index-DI4YInPS.js";import{S as b}from"./skeleton-DV0SbO6m.js";import{T as Z,a as _,b as L,c as n,d as ee,e as l}from"./table-Dh8obmbd.js";import{C as se}from"./candlestick-chart-cell-khzW8HFm.js";import{S as te}from"./search-DL_GMNbq.js";import{A as ae}from"./arrow-right-CkzTyZ9i.js";import{T as re}from"./trending-down-DrlS2k3i.js";import{A as ie}from"./arrow-up-down-DSsJmQNo.js";import{A as ne,a as le}from"./arrow-up-DPXP0D04.js";import"./LineChart-UzXyIzcs.js";function fe(){const{toast:v}=R(),{user:S}=H(),[,M]=J(),[x,O]=d.useState(""),[m,Q]=d.useState("signal"),[c,k]=d.useState("desc"),{data:C=[],isLoading:I}=z({queryKey:["/api/followed-stocks-with-status"],enabled:!!S,refetchInterval:s=>{const t=s.state.data;return t&&t.some(a=>a.jobStatus==="pending"||a.jobStatus==="processing")?5e3:!1}}),{data:P=[]}=z({queryKey:["/api/portfolio/holdings"],enabled:!!S}),T=E({mutationFn:async s=>await K("DELETE",`/api/stocks/${s}/follow`,null),onSuccess:()=>{g.invalidateQueries({queryKey:["/api/followed-stocks-with-status"]}),g.invalidateQueries({queryKey:["/api/followed-stocks/count"]}),v({title:"Stock Unfollowed",description:"Stock removed from your following list"})}}),A=E({mutationFn:async({ticker:s,price:t})=>await K("POST","/api/portfolio/holdings",{ticker:s,quantity:1,averagePurchasePrice:t.toString(),isSimulated:!1}),onSuccess:()=>{g.invalidateQueries({queryKey:["/api/portfolio/holdings"]}),g.invalidateQueries({queryKey:["/api/positions/count"]}),v({title:"Position Entered",description:"Stock added to your positions"})}}),F=s=>P.some(t=>t.ticker===s&&t.quantity>0&&!t.isSimulated),h=s=>{m===s?k(c==="asc"?"desc":"asc"):(Q(s),k(s==="ticker"?"asc":"desc"))},p=({field:s})=>m!==s?e.jsx(ie,{className:"h-4 w-4 ml-1"}):c==="asc"?e.jsx(ne,{className:"h-4 w-4 ml-1"}):e.jsx(le,{className:"h-4 w-4 ml-1"}),j=d.useMemo(()=>{const s=C.filter(r=>!F(r.ticker));if(!x.trim())return s;const t=x.toUpperCase();return s.filter(r=>{var a;return r.ticker.includes(t)||((a=r.companyName)==null?void 0:a.toUpperCase().includes(t))})},[C,x,P]),q=d.useMemo(()=>[...j].sort((s,t)=>{let r,a;switch(m){case"ticker":r=s.ticker,a=t.ticker;break;case"signal":r=s.integratedScore??s.aiScore??0,a=t.integratedScore??t.aiScore??0;break;case"price":r=parseFloat(s.currentPrice||"0"),a=parseFloat(t.currentPrice||"0");break;case"change":r=parseFloat(s.priceChangePercent||"0"),a=parseFloat(t.priceChangePercent||"0");break;default:return 0}return r<a?c==="asc"?-1:1:r>a?c==="asc"?1:-1:0}),[j,m,c]);return I?e.jsxs("div",{className:"p-4 md:p-6 space-y-4",children:[e.jsx(b,{className:"h-8 w-48"}),e.jsx(b,{className:"h-10 w-full max-w-md"}),e.jsx("div",{className:"rounded-md border",children:e.jsx(b,{className:"h-[400px] w-full"})})]}):e.jsxs("div",{className:"p-4 md:p-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-xl font-semibold whitespace-nowrap","data-testid":"text-page-title",children:"Following"}),e.jsxs(N,{children:[e.jsx(w,{asChild:!0,children:e.jsx(o,{variant:"ghost",size:"icon",className:"h-6 w-6",children:e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"})})}),e.jsx(y,{side:"bottom",className:"max-w-xs",children:e.jsx("p",{className:"text-xs",children:"Stocks you've chosen to follow from Opportunities. Enter a position when ready to track P&L."})})]}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-2","data-testid":"text-following-count",children:["(",j.length,")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground"}),e.jsx(G,{placeholder:"Search...",value:x,onChange:s=>O(s.target.value),className:"pl-8 h-8 w-32 text-sm","data-testid":"input-search-following"})]})]}),q.length===0?e.jsx(W,{className:"bg-notebook-page",children:e.jsxs(V,{className:"p-8 text-center",children:[e.jsx(B,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No stocks followed yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Start following stocks from the Opportunities page to track them here."}),e.jsx($,{href:"/opportunities",children:e.jsxs(o,{"data-testid":"button-go-to-opportunities",children:["Browse Opportunities",e.jsx(ae,{className:"h-4 w-4 ml-2"})]})})]})}):e.jsx("div",{className:"rounded-md border",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Z,{className:"text-xs",children:[e.jsx(_,{className:"bg-background",children:e.jsxs(L,{children:[e.jsx(n,{className:"min-w-[60px] px-1",children:e.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>h("ticker"),className:"px-1 h-7 text-xs","data-testid":"sort-ticker",children:["Ticker",e.jsx(p,{field:"ticker"})]})}),e.jsx(n,{className:"hidden md:table-cell min-w-[100px] px-1",children:"Company"}),e.jsx(n,{className:"text-right w-[70px] px-1",children:e.jsxs(N,{children:[e.jsx(w,{asChild:!0,children:e.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>h("signal"),className:"px-1 h-7 text-xs","data-testid":"sort-signal",children:["Signal",e.jsx(p,{field:"signal"})]})}),e.jsx(y,{side:"top",className:"max-w-xs text-xs",children:e.jsx("p",{children:"Signal strength (0-100)"})})]})}),e.jsx(n,{className:"min-w-[55px] px-1",children:"Type"}),e.jsx(n,{className:"text-right min-w-[65px] px-1",children:e.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>h("price"),className:"px-1 h-7 text-xs","data-testid":"sort-price",children:["Price",e.jsx(p,{field:"price"})]})}),e.jsx(n,{className:"hidden lg:table-cell min-w-[100px] px-1",children:"Trend"}),e.jsx(n,{className:"text-right min-w-[70px] px-1",children:e.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>h("change"),className:"px-1 h-7 text-xs","data-testid":"sort-change",children:["Chg %",e.jsx(p,{field:"change"})]})}),e.jsx(n,{className:"hidden xl:table-cell w-[70px] px-1",children:"Mkt Cap"}),e.jsx(n,{className:"w-[130px] px-1 text-right",children:"Actions"})]})}),e.jsx(ee,{children:q.map(s=>{const t=parseFloat(s.currentPrice||"0"),r=parseFloat(s.priceChangePercent||"0"),a=r>=0,U=F(s.ticker),i=s.integratedScore??s.aiScore??null;return e.jsxs(L,{className:"hover-elevate h-10 cursor-pointer","data-testid":`row-stock-${s.ticker}`,onClick:()=>M(`/ticker/${s.ticker}?from=following`),children:[e.jsx(l,{className:"font-mono font-medium py-1 px-1 text-xs",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(B,{className:"h-3 w-3 text-primary fill-current"}),e.jsx($,{href:`/ticker/${s.ticker}?from=following`,className:"hover:underline",children:s.ticker})]})}),e.jsx(l,{className:"hidden md:table-cell text-muted-foreground text-xs truncate max-w-[200px] py-1 px-1",children:s.companyName||"-"}),e.jsx(l,{className:"text-right py-1 px-1",children:i!==null?e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(u,{className:D("font-mono text-xs",i>=90&&"bg-amber-500 text-white",i>=70&&i<90&&"bg-amber-100 text-amber-700 dark:bg-amber-950 dark:text-amber-400",i>=50&&i<70&&"bg-secondary text-secondary-foreground",i<50&&"bg-secondary text-muted-foreground opacity-60"),children:i})}),e.jsxs(y,{children:["Signal strength: ",i,"/100"]})]}):s.jobStatus==="pending"||s.jobStatus==="processing"?e.jsx(u,{variant:"outline",className:"text-[10px]",children:"Analyzing..."}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"-"})}),e.jsx(l,{className:"py-1 px-1",children:s.insiderAction&&e.jsx(u,{variant:s.insiderAction==="BUY"?"default":"destructive",className:"text-[10px]",children:s.insiderAction})}),e.jsxs(l,{className:"text-right font-mono py-1 px-1 text-xs",children:["$",t.toFixed(2)]}),e.jsx(l,{className:"hidden lg:table-cell py-1 px-1",children:e.jsx("div",{className:"h-8 w-[100px]",children:e.jsx(se,{ticker:s.ticker,height:32})})}),e.jsx(l,{className:"text-right py-1 px-1",children:e.jsxs("div",{className:D("flex items-center justify-end gap-0.5 text-xs",a?"text-success":"text-destructive"),children:[a?e.jsx(X,{className:"h-3 w-3"}):e.jsx(re,{className:"h-3 w-3"}),e.jsxs("span",{className:"font-mono",children:[a?"+":"",r.toFixed(1),"%"]})]})}),e.jsx(l,{className:"hidden xl:table-cell text-muted-foreground py-1 px-1 text-xs",children:s.marketCap||"-"}),e.jsx(l,{className:"text-right py-1 px-1",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(o,{size:"sm",variant:"ghost",className:"h-7 px-2 text-xs text-muted-foreground",onClick:f=>{f.stopPropagation(),T.mutate(s.ticker)},disabled:T.isPending,"data-testid":`button-unfollow-${s.ticker}`,children:"Unfollow"}),!U&&e.jsx(o,{size:"sm",variant:"default",className:"h-7 px-2 text-xs",onClick:f=>{f.stopPropagation(),A.mutate({ticker:s.ticker,price:t})},disabled:A.isPending,"data-testid":`button-enter-${s.ticker}`,children:"Enter"}),U&&e.jsx(u,{variant:"outline",className:"text-[10px]",children:"In Position"})]})})]},s.ticker)})})]})})})]})}export{fe as default};
