import{c as ae,a as ge,d as je,r as h,u as k,e as D,q as b,b as A,j as e,C as P,f as Q,g as O,h as C,v as I,B as f,V as H,W as ye,ch as we,X as be,cz as ke,cA as Pe,G as ie,T as re,S as ne,E as Ce,F as Se,cB as Fe,A as Ee,i as _e,k as $e}from"./index-DI4YInPS.js";import{S as V}from"./skeleton-DV0SbO6m.js";import{C as Te,a as le,b as oe,c as ce}from"./collapsible-wj_V0Br0.js";import{S as De}from"./switch-DQ4dWgf9.js";import{S as de,a as ue,b as me,c as xe,d as J,e as pe}from"./select-CpnPcG5S.js";import{R as Ae,L as Me,X as qe,Y as Re,T as Le,c as ze,b as se,a as Ke}from"./LineChart-UzXyIzcs.js";import{P as Ie}from"./plus-Dkh6wZPX.js";import{B as Be,G as Qe,N as Oe,S as Ve,E as Ue,T as Ge}from"./stock-ai-analysis-D7p_mAi7.js";import{T as Ye}from"./textarea-BbOWcGDL.js";import{A as he}from"./arrow-left-Crys1qZm.js";import{T as We}from"./trending-down-DrlS2k3i.js";import{B as fe}from"./briefcase-C7pZccv6.js";import{M as Xe}from"./message-square-CX97MEnf.js";import{D as He}from"./dollar-sign-DIwU8lDS.js";import"./index-B-eDo8U8.js";import"./arrow-up-DPXP0D04.js";import"./pause-B2oYiJbo.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=ae("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=ae("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=ae("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function tt({ticker:n,stock:r}){const{user:u}=ge(),{toast:M}=je(),[Z,E]=h.useState(!1),[p,g]=h.useState("sell"),[d,U]=h.useState("price_change_percent"),[s,G]=h.useState(""),[q,ee]=h.useState(!0),{data:S,isLoading:Y}=k({queryKey:["/api/rules",u==null?void 0:u.id],enabled:!!u,queryFn:async()=>{const t=await fetch("/api/rules",{credentials:"include"});if(!t.ok)throw new Error("Failed to fetch rules");return t.json()}}),_=D({mutationFn:async t=>await A("POST","/api/rules",t),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/rules",u==null?void 0:u.id]}),M({title:"Trading rule created",description:`Rule created for ${n}${q?" with notifications enabled":""}`}),E(!1),G("")},onError:t=>{M({title:"Failed to create rule",description:t.message||"An error occurred",variant:"destructive"})}}),R=D({mutationFn:async t=>await A("DELETE",`/api/rules/${t}`,null),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/rules",u==null?void 0:u.id]}),M({title:"Trading rule deleted",description:"The trading rule has been removed"})},onError:t=>{M({title:"Failed to delete rule",description:t.message||"An error occurred",variant:"destructive"})}}),{data:L}=k({queryKey:["/api/portfolio/holdings"],retry:!1,meta:{ignoreError:!0}}),{data:j}=k({queryKey:["/api/portfolio/holdings","simulated"],queryFn:async()=>{const t=await fetch("/api/portfolio/holdings?simulated=true");return t.ok?t.json():[]},retry:!1,meta:{ignoreError:!0}}),{data:$}=k({queryKey:["/api/trades"],retry:!1,meta:{ignoreError:!0}}),{data:x,isLoading:F}=k({queryKey:[`/api/stocks/${n}/candlesticks`],retry:!1,meta:{ignoreError:!0}}),{data:W=[]}=k({queryKey:["/api/users/me/followed"],enabled:!!u,retry:!1,meta:{ignoreError:!0}}),z=W.find(t=>t.ticker===n),N=z!=null&&z.entryPrice?parseFloat(z.entryPrice):null,y=(L==null?void 0:L.find(t=>t.ticker===n))||(j==null?void 0:j.find(t=>t.ticker===n)),o=y?parseFloat(y.averagePurchasePrice):null,X=!!(j!=null&&j.find(t=>t.ticker===n)),K=parseFloat(r.currentPrice),v=y&&o?(K-o)*y.shares:null,a=y&&o?(K-o)/o*100:null,m=h.useMemo(()=>{if(!$)return null;const t=$.filter(i=>i.ticker===n&&i.type==="buy"&&i.executedAt);if(t.length===0)return null;const c=t.sort((i,l)=>new Date(i.executedAt).getTime()-new Date(l.executedAt).getTime())[0];return c!=null&&c.executedAt?new Date(c.executedAt):null},[$,n]),te=h.useMemo(()=>{const t=x==null?void 0:x.candlestickData;return!t||t.length===0?[]:t.filter(i=>m?new Date(i.date)>=m:!0).map(i=>({date:i.date,price:i.close})).sort((i,l)=>new Date(i.date).getTime()-new Date(l.date).getTime())},[x==null?void 0:x.candlestickData,m]),B=h.useMemo(()=>{if(!S)return[];const t=[];return S.filter(i=>i.enabled&&(i.action==="sell"||i.action==="sell_all")&&(i.scope==="all_holdings"||i.scope==="specific_stock"&&i.ticker===n)).forEach(i=>{if(!i.conditions||i.conditions.length===0)return;const l=i.conditions[0];let w=0;if(l.metric==="price_change_percent"?w=(l.baselinePrice||o||parseFloat(r.currentPrice))*(1+l.value/100):l.metric==="price_change_from_close_percent"?w=parseFloat(r.previousClose||r.currentPrice)*(1+l.value/100):l.metric==="price_absolute"&&(w=l.value),w>0){const T=`${l.metric==="price_change_percent"?`${l.value>0?"+":""}${l.value}%`:`$${l.value}`}`;t.push({rule:i,price:w,label:T})}}),t},[S,n,o,r]),ve=h.useMemo(()=>{const t=te.map(T=>T.price);if(t.length===0)return["auto","auto"];const c=[...t,...o?[o]:[],...N?[N]:[],...B.map(T=>T.price)],i=Math.min(...c),l=Math.max(...c),w=(l-i)*.05;return[Math.floor((i-w)*100)/100,Math.ceil((l+w)*100)/100]},[te,o,N,B,n]),Ne=()=>{const t=parseFloat(s);if(isNaN(t)){M({title:"Invalid value",description:"Please enter a valid number",variant:"destructive"});return}const c=d==="price_change_percent"?t:Math.abs(t);let i;d==="price_change_percent"?i=t>=0?"greater_than_or_equal":"less_than_or_equal":i="less_than_or_equal";const l=d==="price_change_percent"?o||parseFloat(r.currentPrice):void 0,w={name:`${n} ${p} at ${d==="price_change_percent"?`${t>0?"+":""}${t}%`:`$${c}`}`,scope:"specific_stock",ticker:n,action:p,conditions:[{metric:d,operator:i,value:c,baselinePrice:l}],enabled:!0,notifyOnTrigger:q};_.mutate(w)};return F?e.jsxs(P,{children:[e.jsx(Q,{children:e.jsx(O,{children:"Price Simulation"})}),e.jsx(C,{children:e.jsx(V,{className:"h-64 w-full"})})]}):!F&&(!(x!=null&&x.candlestickData)||x.candlestickData.length===0)?e.jsxs(P,{children:[e.jsx(Q,{children:e.jsx(O,{children:"Price Simulation"})}),e.jsx(C,{children:e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No price data available for simulation"})})]}):Y?e.jsxs(P,{children:[e.jsx(Q,{children:e.jsx(O,{children:"Price Simulation"})}),e.jsx(C,{children:e.jsx(V,{className:"h-64 w-full"})})]}):e.jsxs(P,{children:[e.jsxs(Q,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(O,{children:"Price Chart with Trading Rules"}),y&&e.jsx(I,{variant:X?"secondary":"default","data-testid":"badge-position",children:X?"Simulated Position":"Actual Position"})]}),o&&e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Entry: $",o.toFixed(2)," ",m&&`on ${m.toISOString().split("T")[0]}`]}),v!==null&&a!==null&&e.jsxs("div",{className:`flex items-center gap-1 font-medium ${v>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[e.jsxs("span",{"data-testid":"text-unrealized-pnl",children:[v>=0?"+":"","$",v.toFixed(2)," (",v>=0?"+":"",a.toFixed(2),"%)"]}),e.jsx(I,{variant:v>=0?"default":"destructive",className:"text-xs",children:"Unrealized P&L"})]})]})]}),e.jsxs(C,{children:[e.jsx(Ae,{width:"100%",height:400,children:e.jsxs(Me,{data:te,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Te,{strokeDasharray:"3 3",stroke:"oklch(var(--border))"}),e.jsx(qe,{dataKey:"date",stroke:"oklch(var(--muted-foreground))",tick:{fill:"oklch(var(--foreground))",fontSize:12},tickFormatter:t=>{const c=new Date(t);return`${c.getMonth()+1}/${c.getDate()}`}}),e.jsx(Re,{stroke:"oklch(var(--muted-foreground))",tick:{fill:"oklch(var(--foreground))",fontSize:12},tickFormatter:t=>`$${t.toFixed(0)}`,domain:ve}),e.jsx(Le,{contentStyle:{backgroundColor:"oklch(var(--popover))",border:"1px solid oklch(var(--border))",borderRadius:"6px",color:"oklch(var(--popover-foreground))"},labelFormatter:t=>new Date(t).toLocaleDateString(),formatter:t=>[`$${Number(t).toFixed(2)}`,"Price"]}),e.jsx(ze,{wrapperStyle:{color:"oklch(var(--foreground))"}}),o&&e.jsx(se,{y:o,stroke:"oklch(var(--primary))",strokeDasharray:"5 5",label:{value:`Entry: $${o.toFixed(2)}`,position:"insideTopRight",fill:"oklch(var(--primary))",fontSize:12}}),N&&!o&&e.jsx(se,{y:N,stroke:"hsl(142.1 76.2% 36.3%)",strokeDasharray:"5 5",label:{value:`Entry: $${N.toFixed(2)}`,position:"insideTopRight",fill:"hsl(142.1 76.2% 36.3%)",fontSize:12}}),B.map((t,c)=>e.jsx(se,{y:t.price,stroke:"oklch(var(--destructive))",strokeDasharray:"3 3",label:{value:`Sell ${t.label}`,position:"insideTopRight",fill:"oklch(var(--destructive))",fontSize:12}},c)),e.jsx(Ke,{type:"monotone",dataKey:"price",stroke:"oklch(var(--chart-1))",strokeWidth:2,dot:!1,name:n})]})}),e.jsx("div",{className:"mt-6 pt-4 border-t",children:Z?e.jsxs("div",{className:"space-y-4 p-4 bg-muted rounded-md",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Create Trading Rule"}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>E(!1),"data-testid":"button-cancel-rule",children:"Cancel"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"rule-action",children:"Action"}),e.jsxs(de,{value:p,onValueChange:t=>g(t),children:[e.jsx(ue,{id:"rule-action","data-testid":"select-rule-action",children:e.jsx(me,{})}),e.jsxs(xe,{children:[e.jsx(J,{value:"sell",children:"Sell"}),e.jsx(J,{value:"sell_all",children:"Sell All"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"condition-metric",children:"Condition"}),e.jsxs(de,{value:d,onValueChange:t=>U(t),children:[e.jsx(ue,{id:"condition-metric","data-testid":"select-condition-metric",children:e.jsx(me,{})}),e.jsxs(xe,{children:[e.jsx(J,{value:"price_change_percent",children:"Price Change %"}),e.jsx(J,{value:"price_absolute",children:"Absolute Price"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(H,{htmlFor:"condition-value",children:[d==="price_change_percent"?"Percentage":"Price"," "," ",d==="price_change_percent"&&"(e.g., 10 for +10%, -5 for -5%)"]}),e.jsx(ye,{id:"condition-value",type:"number",step:d==="price_change_percent"?"0.1":"0.01",placeholder:d==="price_change_percent"?"Enter percentage":"Enter price",value:s,onChange:t=>G(t.target.value),"data-testid":"input-condition-value"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-background rounded-md border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[q?e.jsx(we,{className:"h-4 w-4 text-primary"}):e.jsx(Je,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"enable-notifications",className:"cursor-pointer",children:"Enable Notifications"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Get alerted when this rule triggers for ",n]})]})]}),e.jsx(De,{id:"enable-notifications",checked:q,onCheckedChange:ee,"data-testid":"switch-notifications"})]}),e.jsx(f,{onClick:Ne,className:"w-full",disabled:_.isPending||!s,"data-testid":"button-create-rule",children:_.isPending?"Creating...":"Create Rule"})]}):e.jsxs(f,{onClick:()=>E(!0),variant:"outline",size:"sm",className:"w-full","data-testid":"button-add-rule",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Add Trading Rule for ",n]})}),B.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Active Trading Rules:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:B.map((t,c)=>e.jsxs("div",{className:"relative group",children:[e.jsxs(I,{variant:"outline",className:"pr-6","data-testid":`badge-rule-${t.rule.id}`,children:["Sell at ",t.label," ($",t.price.toFixed(2),")"]}),e.jsx(f,{variant:"ghost",size:"icon",className:"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-destructive text-destructive-foreground opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>R.mutate(t.rule.id),disabled:R.isPending,"data-testid":`button-delete-rule-${t.rule.id}`,children:e.jsx(be,{className:"h-3 w-3"})})]},c))})]})]})]})}const st=n=>{switch(n){case"following":return{href:"/following",label:"Following"};case"in-position":return{href:"/in-position",label:"In Position"};case"community":return{href:"/community",label:"Community"};case"opportunities":default:return{href:"/opportunities",label:"Opportunities"}}},at=(n,r)=>r?{label:"In Position",variant:"default",icon:He}:n?{label:"Following",variant:"secondary",icon:Ue}:{label:"Opportunity",variant:"outline",icon:Ge};function yt(){const{ticker:n}=ke(),r=n==null?void 0:n.toUpperCase(),u=Pe(),Z=h.useMemo(()=>new URLSearchParams(u),[u]).get("from"),E=st(Z),{toast:p}=je(),{user:g}=ge(),[d,U]=h.useState(""),{data:s,isLoading:G}=k({queryKey:["/api/stocks",r],enabled:!!r}),{data:q=[],isFetching:ee}=k({queryKey:["/api/users/me/followed"],enabled:!!g,retry:!1,meta:{ignoreError:!0}}),S=q.find(a=>a.ticker===r),Y=!!S,_=(S==null?void 0:S.hasEnteredPosition)??!1,R=at(Y,_),L=D({mutationFn:async a=>await A("POST",`/api/stocks/${a}/view`,null),onSuccess:()=>{g!=null&&g.id&&b.invalidateQueries({queryKey:["/api/stock-views",g.id]}),b.invalidateQueries({queryKey:["/api/stocks/with-user-status"]})}});h.useEffect(()=>{r&&g&&!L.isPending&&L.mutate(r)},[r,g==null?void 0:g.id]);const{data:j=[]}=k({queryKey:["/api/stocks",r,"comments"],enabled:!!r,retry:!1,meta:{ignoreError:!0}}),$=D({mutationFn:async()=>await A("POST",`/api/stocks/${r}/follow`,null),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/users/me/followed"]}),b.invalidateQueries({queryKey:["/api/opportunities"]}),p({title:"Following",description:`You are now following ${r}`})},onError:a=>{p({title:"Error",description:a.message||"Failed to follow stock",variant:"destructive"})}}),x=D({mutationFn:async()=>await A("DELETE",`/api/stocks/${r}/follow`,null),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/users/me/followed"]}),p({title:"Unfollowed",description:`You are no longer following ${r}`})},onError:a=>{p({title:"Error",description:a.message||"Failed to unfollow stock",variant:"destructive"})}}),F=D({mutationFn:async({hasEnteredPosition:a,entryPrice:m})=>await A("PATCH",`/api/stocks/${r}/position`,{hasEnteredPosition:a,entryPrice:m}),onSuccess:(a,m)=>{b.invalidateQueries({queryKey:["/api/users/me/followed"]}),p({title:m.hasEnteredPosition?"Position entered":"Position exited",description:m.hasEnteredPosition?`Marked as in position for ${r}`:`Marked as watching ${r}`})},onError:a=>{p({title:"Error",description:a.message||"Failed to update position",variant:"destructive"})}}),W=D({mutationFn:async a=>await A("POST",`/api/stocks/${r}/comments`,{comment:a}),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/stocks",r,"comments"]}),U(""),p({title:"Comment added",description:"Your comment has been posted"})},onError:a=>{p({title:"Error",description:a.message||"Failed to add comment",variant:"destructive"})}}),z=a=>a.split(" ").map(m=>m[0]).join("").toUpperCase().slice(0,2);if(G)return e.jsx("div",{className:"p-4 md:p-6 h-full",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 h-full",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(V,{className:"h-48 w-full"}),e.jsx(V,{className:"h-64 w-full"})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(V,{className:"h-[500px] w-full"})})]})});if(!s)return e.jsx("div",{className:"p-4 md:p-6",children:e.jsx(P,{children:e.jsxs(C,{className:"p-8 text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:"Stock not found"}),e.jsx(f,{variant:"outline",asChild:!0,className:"mt-4",children:e.jsxs(ie,{href:E.href,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Back to ",E.label]})})]})})});const N=parseFloat(s.currentPrice||"0"),y=parseFloat(s.previousClose||"0"),o=N-y,X=y>0?o/y*100:0,K=o>=0,v=s.news?typeof s.news=="string"?JSON.parse(s.news):s.news:[];return e.jsx("div",{className:"p-4 md:p-6 h-full overflow-auto",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-3 lg:sticky lg:top-0 lg:self-start lg:max-h-[calc(100vh-3rem)] lg:overflow-y-auto",children:[e.jsx(P,{children:e.jsxs(C,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(f,{variant:"ghost",size:"icon",className:"h-7 w-7",asChild:!0,"data-testid":"button-back",children:e.jsx(ie,{href:E.href,children:e.jsx(he,{className:"h-3.5 w-3.5"})})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("h1",{className:"text-lg font-bold font-mono","data-testid":"heading-ticker",children:s.ticker}),e.jsxs(I,{variant:R.variant,className:"text-[9px] h-4","data-testid":"badge-stage",children:[e.jsx(R.icon,{className:"h-2.5 w-2.5 mr-0.5"}),R.label]})]}),s.companyName&&e.jsx("p",{className:"text-[10px] text-muted-foreground","data-testid":"text-company-name",children:s.companyName})]})]}),e.jsxs("div",{className:"flex items-baseline gap-2 mb-2",children:[e.jsxs("span",{className:"text-xl font-bold font-mono","data-testid":"text-current-price",children:["$",N.toFixed(2)]}),e.jsxs("div",{className:`flex items-center gap-0.5 ${K?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[K?e.jsx(re,{className:"h-3 w-3"}):e.jsx(We,{className:"h-3 w-3"}),e.jsxs("span",{className:"text-xs font-medium","data-testid":"text-price-change",children:[K?"+":"",X.toFixed(2),"%"]})]})]}),e.jsxs("div",{className:"flex gap-4 text-[10px] mb-2",children:[s.marketCap&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"MCap "}),e.jsx("span",{className:"font-mono","data-testid":"text-market-cap",children:s.marketCap})]}),s.peRatio&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"P/E "}),e.jsx("span",{className:"font-mono","data-testid":"text-pe-ratio",children:parseFloat(s.peRatio).toFixed(1)})]})]}),Y?_?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-1 px-2 py-1.5 bg-primary/10 rounded text-xs",children:[e.jsx(fe,{className:"h-3.5 w-3.5 text-primary"}),e.jsx("span",{className:"font-medium text-primary",children:"In Position"})]}),e.jsx(f,{variant:"outline",size:"sm",className:"h-8 text-xs px-3",onClick:()=>F.mutate({hasEnteredPosition:!1}),disabled:F.isPending,"data-testid":"button-exit-position",children:"Exit"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{size:"sm",className:"flex-1 h-8",onClick:()=>F.mutate({hasEnteredPosition:!0,entryPrice:N}),disabled:F.isPending||ee,"data-testid":"button-enter-position",children:[e.jsx(re,{className:"h-3.5 w-3.5 mr-1.5"}),F.isPending?"Entering...":"Enter Position"]}),e.jsx(f,{variant:"ghost",size:"sm",className:"h-8 px-2",onClick:()=>x.mutate(),disabled:x.isPending,"data-testid":"button-unfollow",children:e.jsx(ne,{className:"h-3.5 w-3.5 fill-current"})})]}):e.jsxs(f,{size:"sm",className:"w-full h-8",onClick:()=>$.mutate(),disabled:$.isPending,"data-testid":"button-follow",children:[e.jsx(ne,{className:"h-3.5 w-3.5 mr-1.5"}),$.isPending?"Following...":"Follow"]})]})}),e.jsxs(P,{children:[e.jsx(Q,{className:"p-3 pb-1",children:e.jsxs(O,{className:"flex items-center gap-1.5 text-xs",children:[e.jsx(Be,{className:"h-3 w-3"}),"Company & Insider"]})}),e.jsxs(C,{className:"p-3 pt-0 space-y-2",children:[s.description&&e.jsx("p",{className:"text-[10px] text-muted-foreground line-clamp-3","data-testid":"text-description",children:s.description}),e.jsxs("div",{className:"flex flex-wrap gap-x-3 gap-y-1 text-[10px]",children:[s.industry&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"h-2.5 w-2.5 text-muted-foreground"}),e.jsx("span",{"data-testid":"text-industry",children:s.industry})]}),s.country&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Qe,{className:"h-2.5 w-2.5 text-muted-foreground"}),e.jsx("span",{"data-testid":"text-country",children:s.country})]}),s.ipo&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ce,{className:"h-2.5 w-2.5 text-muted-foreground"}),e.jsx("span",{"data-testid":"text-ipo",children:s.ipo})]})]}),s.webUrl&&e.jsx(f,{variant:"outline",size:"sm",asChild:!0,className:"w-full h-6 text-[10px]",children:e.jsxs("a",{href:s.webUrl,target:"_blank",rel:"noopener noreferrer",children:["Website ",e.jsx(Se,{className:"h-2.5 w-2.5 ml-1"})]})}),(s.insiderPrice||s.insiderTradeDate||s.insiderName)&&e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"my-1"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-medium",children:[e.jsx(Ze,{className:"h-3 w-3 text-amber-600"}),"Insider Trade"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1 text-[10px]",children:[s.insiderName&&e.jsxs("div",{className:"col-span-2 flex items-center gap-1",children:[e.jsx(et,{className:"h-2.5 w-2.5 text-muted-foreground"}),e.jsx("span",{className:"truncate","data-testid":"text-insider-name",children:s.insiderName}),s.insiderTitle&&e.jsxs("span",{className:"text-muted-foreground truncate",children:["(",s.insiderTitle,")"]})]}),s.insiderPrice&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Price "}),e.jsxs("span",{className:"font-mono","data-testid":"text-insider-price",children:["$",parseFloat(s.insiderPrice).toFixed(2)]})]}),s.insiderQuantity&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Shares "}),e.jsx("span",{"data-testid":"text-insider-quantity",children:s.insiderQuantity.toLocaleString()})]}),s.insiderTradeDate&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Date "}),e.jsx("span",{"data-testid":"text-trade-date",children:s.insiderTradeDate})]}),s.marketPriceAtInsiderDate&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Mkt@ "}),e.jsxs("span",{className:"font-mono",children:["$",parseFloat(s.marketPriceAtInsiderDate).toFixed(2)]})]})]})]})]})]})]}),e.jsx(P,{children:e.jsx(C,{className:"p-3",children:e.jsxs(le,{className:"group",children:[e.jsx(oe,{asChild:!0,children:e.jsxs("button",{className:"w-full flex items-center justify-between cursor-pointer","data-testid":"button-toggle-news",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-xs font-medium",children:[e.jsx(Oe,{className:"h-3 w-3"}),"News",v.length>0&&e.jsx(I,{variant:"secondary",className:"text-[8px] h-4",children:v.length})]}),e.jsx(pe,{className:"h-3.5 w-3.5 transition-transform group-data-[state=open]:rotate-180"})]})}),e.jsx(ce,{className:"pt-2",children:v.length>0?e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:v.slice(0,5).map((a,m)=>e.jsxs("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"block p-1.5 rounded hover:bg-muted/50 transition-colors",children:[e.jsx("p",{className:"text-[10px] font-medium line-clamp-2 mb-0.5",children:a.headline}),e.jsxs("div",{className:"flex items-center gap-2 text-[9px] text-muted-foreground",children:[e.jsx("span",{className:"truncate max-w-[100px]",children:a.source}),e.jsx("span",{children:new Date(a.datetime*1e3).toLocaleDateString()})]})]},m))}):e.jsx("p",{className:"text-[10px] text-muted-foreground text-center py-2",children:"No news available"})})]})})}),e.jsx(P,{children:e.jsx(C,{className:"p-3",children:e.jsxs(le,{className:"group",children:[e.jsx(oe,{asChild:!0,children:e.jsxs("button",{className:"w-full flex items-center justify-between cursor-pointer","data-testid":"button-toggle-discussion",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-xs font-medium",children:[e.jsx(Xe,{className:"h-3 w-3"}),"Discussion",j.length>0&&e.jsx(I,{variant:"secondary",className:"text-[8px] h-4",children:j.length})]}),e.jsx(pe,{className:"h-3.5 w-3.5 transition-transform group-data-[state=open]:rotate-180"})]})}),e.jsxs(ce,{className:"pt-2 space-y-2",children:[e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx(Ye,{placeholder:"Add comment...",value:d,onChange:a=>U(a.target.value),rows:1,className:"text-[10px] min-h-[28px] py-1.5","data-testid":"input-comment"}),e.jsx(f,{size:"sm",className:"h-7 px-2 text-[10px]",onClick:()=>{d.trim()&&W.mutate(d)},disabled:!d.trim()||W.isPending,"data-testid":"button-add-comment",children:"Post"})]}),j.length===0?e.jsx("p",{className:"text-[9px] text-muted-foreground text-center py-2",children:"Be the first to comment!"}):e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:j.map(a=>a.user?e.jsxs("div",{className:"flex gap-1.5","data-testid":`comment-${a.id}`,children:[e.jsx(Ee,{className:"h-5 w-5",children:e.jsx(_e,{className:"text-[8px]",children:z(a.user.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1 text-[9px]",children:[e.jsx("span",{className:"font-medium truncate",children:a.user.name}),a.createdAt&&e.jsx("span",{className:"text-muted-foreground",children:$e(new Date(a.createdAt),{addSuffix:!0})})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:a.comment})]})]},a.id):null)})]})]})})})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsx(Ve,{ticker:r}),_&&e.jsx(tt,{ticker:r,stock:s})]})]})})}export{yt as default};
