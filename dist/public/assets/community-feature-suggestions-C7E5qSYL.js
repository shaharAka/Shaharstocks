import{c as M,a as R,d as V,r as j,u as E,e as u,j as t,a6 as F,C as m,f as T,g as $,a8 as B,h as x,W as H,B as o,a7 as K,k as U,a1 as O,a9 as Q,q as g,b as p,v}from"./index-DI4YInPS.js";import{T as z}from"./textarea-BbOWcGDL.js";import{S as Y,a as W,b as Z,c as G,d as b}from"./select-CpnPcG5S.js";import{M as J}from"./message-square-CX97MEnf.js";import"./index-B-eDo8U8.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=M("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);function ie(){const{user:s,isLoading:k}=R(),{toast:i}=V(),[d,y]=j.useState(""),[r,N]=j.useState(""),[l,P]=j.useState("all"),{data:h=[]}=E({queryKey:["/api/feature-suggestions",s==null?void 0:s.id],queryFn:async()=>{const e=new URLSearchParams;s!=null&&s.id&&e.append("userId",s.id);const a=`/api/feature-suggestions${e.toString()?`?${e.toString()}`:""}`,n=await fetch(a);if(!n.ok)throw new Error("Failed to fetch suggestions");return n.json()}}),{data:q=[],isLoading:D}=E({queryKey:["/api/feature-suggestions",s==null?void 0:s.id,l],queryFn:async()=>{const e=new URLSearchParams;s!=null&&s.id&&e.append("userId",s.id),l!=="all"&&e.append("status",l);const a=`/api/feature-suggestions${e.toString()?`?${e.toString()}`:""}`,n=await fetch(a);if(!n.ok)throw new Error("Failed to fetch suggestions");return n.json()}}),S=[...q].sort((e,a)=>a.voteCount!==e.voteCount?a.voteCount-e.voteCount:new Date(a.createdAt).getTime()-new Date(e.createdAt).getTime()),f=u({mutationFn:async e=>p("POST","/api/feature-suggestions",{userId:s==null?void 0:s.id,title:e.title,description:e.description,status:"pending"}),onSuccess:()=>{g.invalidateQueries({queryKey:["/api/feature-suggestions"]}),y(""),N(""),i({title:"Success",description:"Your feature suggestion has been submitted!"})},onError:e=>{let a="Failed to submit feature suggestion";e!=null&&e.message?a=e.message:e!=null&&e.error&&(a=typeof e.error=="string"?e.error:"Failed to submit feature suggestion"),i({title:"Error",description:a,variant:"destructive"})}}),w=u({mutationFn:async({suggestionId:e,isVoting:a})=>p(a?"POST":"DELETE",`/api/feature-suggestions/${e}/vote`,{userId:s==null?void 0:s.id}),onSuccess:()=>{g.invalidateQueries({queryKey:["/api/feature-suggestions"]})},onError:()=>{i({title:"Error",description:"Failed to update vote",variant:"destructive"})}}),c=u({mutationFn:async({id:e,status:a})=>p("PATCH",`/api/feature-suggestions/${e}/status`,{status:a}),onSuccess:()=>{g.invalidateQueries({queryKey:["/api/feature-suggestions"]}),i({title:"Success",description:"Suggestion status updated"})},onError:e=>{i({title:"Error",description:e.message||"Failed to update status",variant:"destructive"})}}),C=u({mutationFn:async e=>p("DELETE",`/api/feature-suggestions/${e}`,{}),onSuccess:()=>{g.invalidateQueries({queryKey:["/api/feature-suggestions"]}),i({title:"Success",description:"Suggestion deleted"})},onError:e=>{i({title:"Error",description:e.message||"Failed to delete suggestion",variant:"destructive"})}}),L=e=>{if(e.preventDefault(),console.log("[Community] Submit clicked, user:",s),console.log("[Community] Title:",d,"Description:",r),!(s!=null&&s.id)){console.log("[Community] No user ID, showing error"),i({title:"Error",description:"You must be logged in to submit a suggestion",variant:"destructive"});return}if(!d.trim()||!r.trim()){console.log("[Community] Empty fields, showing error"),i({title:"Error",description:"Please fill in all fields",variant:"destructive"});return}console.log("[Community] Calling mutation with:",{title:d,description:r,userId:s.id}),f.mutate({title:d,description:r})},A=(e,a)=>{w.mutate({suggestionId:e,isVoting:!a})},I=e=>{switch(e){case"pending":return t.jsx(v,{variant:"secondary","data-testid":"badge-status-pending",children:"Pending"});case"roadmap":return t.jsx(v,{className:"bg-green-500 hover:bg-green-600","data-testid":"badge-status-roadmap",children:"On Roadmap"});default:return t.jsx(v,{variant:"outline","data-testid":`badge-status-${e}`,children:e})}};return t.jsxs("div",{className:"container mx-auto p-4 md:p-6 space-y-4 max-w-7xl",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(F,{className:"h-5 w-5 text-primary"}),t.jsx("h1",{className:"text-xl font-semibold whitespace-nowrap","data-testid":"heading-feature-suggestions",children:"Feature Suggestions"})]}),t.jsxs("div",{className:"grid lg:grid-cols-3 gap-4 md:gap-6",children:[t.jsxs(m,{className:"lg:col-span-2",children:[t.jsxs(T,{children:[t.jsx($,{"data-testid":"heading-submit-idea",children:"Submit Your Idea"}),t.jsx(B,{children:"Share a feature you'd like to see in signal2"})]}),t.jsx(x,{children:t.jsxs("form",{onSubmit:L,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"title",className:"text-sm font-medium mb-2 block",children:"Feature Title"}),t.jsx(H,{id:"title",value:d,onChange:e=>y(e.target.value),placeholder:"Brief description of your feature idea","data-testid":"input-title"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"description",className:"text-sm font-medium mb-2 block",children:"Description"}),t.jsx(z,{id:"description",value:r,onChange:e=>N(e.target.value),placeholder:"Explain your feature idea in detail. What problem does it solve? How would it help?",rows:4,"data-testid":"textarea-description"})]}),t.jsx(o,{type:"submit",disabled:f.isPending||k||!(s!=null&&s.id),"data-testid":"button-submit-suggestion",children:f.isPending?"Submitting...":"Submit Suggestion"})]})})]}),t.jsxs(m,{children:[t.jsx(T,{children:t.jsxs($,{className:"flex items-center gap-2",children:[t.jsx(K,{className:"h-5 w-5"}),"Community Stats"]})}),t.jsxs(x,{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Suggestions"}),t.jsx("span",{className:"text-2xl font-bold","data-testid":"text-total-suggestions",children:h.length})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"On Roadmap"}),t.jsx("span",{className:"text-2xl font-bold text-green-600","data-testid":"text-roadmap-count",children:h.filter(e=>e.status==="roadmap").length})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Votes"}),t.jsx("span",{className:"text-2xl font-bold","data-testid":"text-total-votes",children:h.reduce((e,a)=>e+a.voteCount,0)})]})]})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 md:gap-4",children:[t.jsxs("h2",{className:"text-xl md:text-2xl font-bold flex items-center gap-2","data-testid":"heading-suggestions",children:[t.jsx(J,{className:"h-5 w-5 md:h-6 md:w-6"}),"Feature Suggestions"]}),t.jsxs(Y,{value:l,onValueChange:P,children:[t.jsx(W,{className:"w-full sm:w-48","data-testid":"select-status-filter",children:t.jsx(Z,{placeholder:"Filter by status"})}),t.jsxs(G,{children:[t.jsx(b,{value:"all",children:"All Suggestions"}),t.jsx(b,{value:"pending",children:"Pending"}),t.jsx(b,{value:"roadmap",children:"On Roadmap"})]})]})]}),D?t.jsx("div",{className:"text-center py-12 text-muted-foreground","data-testid":"text-loading",children:"Loading suggestions..."}):S.length===0?t.jsx(m,{children:t.jsxs(x,{className:"py-12 text-center text-muted-foreground",children:[t.jsx(F,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{"data-testid":"text-no-suggestions",children:"No suggestions yet. Be the first to submit an idea!"})]})}):t.jsx("div",{className:"space-y-4",children:S.map(e=>t.jsx(m,{"data-testid":`card-suggestion-${e.id}`,children:t.jsx(x,{className:"pt-6",children:t.jsxs("div",{className:"flex gap-4",children:[t.jsxs("div",{className:"flex flex-col items-center gap-1",children:[t.jsx(o,{variant:e.userHasVoted?"default":"outline",size:"lg",onClick:()=>A(e.id,e.userHasVoted),disabled:w.isPending,"data-testid":`button-vote-${e.id}`,children:t.jsx(X,{className:"h-4 w-4"})}),t.jsx("span",{className:"text-lg font-bold","data-testid":`text-vote-count-${e.id}`,children:e.voteCount})]}),t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-semibold mb-1","data-testid":`text-title-${e.id}`,children:e.title}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:["Suggested by ",t.jsx("span",{className:"font-medium",children:e.userName})," â€¢"," ",U(new Date(e.createdAt),{addSuffix:!0})]})]}),I(e.status)]}),t.jsx("p",{className:"text-muted-foreground","data-testid":`text-description-${e.id}`,children:e.description}),(s==null?void 0:s.isAdmin)&&t.jsxs("div",{className:"flex gap-2 pt-2 border-t flex-wrap",children:[t.jsx("span",{className:"text-sm text-muted-foreground mr-2",children:"Admin:"}),e.status!=="roadmap"&&t.jsxs(o,{size:"lg",variant:"outline",onClick:()=>c.mutate({id:e.id,status:"roadmap"}),disabled:c.isPending,"data-testid":`button-add-roadmap-${e.id}`,children:[t.jsx(O,{className:"h-4 w-4 mr-1"}),"Add to Roadmap"]}),e.status==="roadmap"&&t.jsx(o,{size:"lg",variant:"outline",onClick:()=>c.mutate({id:e.id,status:"pending"}),disabled:c.isPending,"data-testid":`button-remove-roadmap-${e.id}`,children:"Remove from Roadmap"}),t.jsxs(o,{size:"lg",variant:"destructive",onClick:()=>{confirm("Are you sure you want to delete this suggestion?")&&C.mutate(e.id)},disabled:C.isPending,"data-testid":`button-delete-${e.id}`,children:[t.jsx(Q,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]})]})})},e.id))})]})}export{ie as default};
